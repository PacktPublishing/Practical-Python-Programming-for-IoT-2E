{% args gpio %}
<!-- 
    The above {% args gpio %} is required by the utemplate engine used by Microdot,
    and it must be the first line in the file.
    
<<<<<<< HEAD
    It defines the arguements used in the page. If it is missing you will receive
    the error "NameError: name 'gpio' isn't defined" on the terminal console as you load
    this page in a browser.

    In microdot_server_pico.py the following code snippet is where the gpio arguement is passed to this page:
=======
    It defines the arguments used in the page. If it is missing you will receive
    the error "NameError: name 'gpio' isn't defined" on the terminal console as you load
    this page in a browser.

    In microdot_server_pico.py the following code snippet is where the gpio argument is passed to this page:
>>>>>>> 729256a (Updated comments)
    
    async def index(request):
        return Template('index_api_client.html').render(gpio=LED_GPIO), {'Content-Type': 'text/html'}
-->
<!DOCTYPE html>
<html>
<head>
    <title>Microdot RESTful API Example</title>
    <script src="/static/jquery.min.js"></script>                                   <!--(1)-->
    <script type="text/javascript">

        // GET request to server to retrieve LED state.
        function getState() {
            $.get("/led", function (serverResponse, status) {                       // (2)
                console.log(serverResponse)
                updateControls(serverResponse)                                      // (3)
            })
        }


        // POST Request to server to set LED state.
        function postUpdate(payload) {                                               // (4)
            $.post({
                url: "/led",
                data: JSON.stringify(payload),
                contentType: 'application/json; charset=utf-8'
            }).done(
                function (serverResponse, status) {
                    console.log(serverResponse)
                    updateControls(serverResponse)                                  // (5)
                })
        }


        function updateControls(data) {
            $("input[type=range].brightnessLevel").val(data.level)                  // (6)
            $("#brightnessLevel").html(data.level)
        }


        $(document).ready(function () {
            // Event listener for Slider value changes.
            // .on('input', ...) will fire as the slider changes (= lots of network traffic). Change to
            // .on('change', ...) to fire only after mouse button is released.
            // Note that on a Pico W, using 'input' may feel a little sluggish as you adjust the slider
            // due to the amount of network traffic being genertated. 
            $("input[type=range].brightnessLevel").on('change', function () {       // (7)
                brightness_level = $(this).val()                                    // (8)
                payload = { "level": brightness_level }                             // (9)
                postUpdate(payload)
            })

            // Initialise slider value form state on server.
            getState()                                                              // (10)
        });

    </script>
</head>

<body>
<<<<<<< HEAD
    <h1>Microdot RESTful API Example</h1>
    LED is connected to GPIO {{gpio}}<br>                                            <!--(11)-->
=======
    <h1>Microdot RESTful API Example</h1>    
    LED is connected to GPIO {{gpio}}<br>                                            <!--(11)-->    
>>>>>>> 729256a (Updated comments)
    Brightness: <span id="brightnessLevel"></span>%<br>
    <input type="range" min="0" max="100" value="0" class="brightnessLevel">         <!--(12)-->
</body>

</html>